# How to build binary components (and XPI package) ?

This software includes some binary components for Firefox 3.6 and older
versions. You need to build binaries for each platform.

For Firefox 4.0 or later, you don't need to build binary components because
System Monitor works with JavaScript components implemented based on js-ctypes.
However, you still need to use XULRunner SDK to rebuild .xpt files (interface
definitions).

## Ubuntu 12.04LTS

 1. Install required packages.
        $ sudo aptitude install git automake libtool libgtop2-dev zip
 2. Install XULRunner SDK. For example, in this case it is installed into
    "$HOME/opt/xulrunner-sdk".
        $ mkdir ~/tmp
        $ cd ~/tmp
        $ wget http://releases.mozilla.org/pub/mozilla.org/xulrunner/releases
                 /X.X.X/sdk/xulrunner-X.X.X.en-US.linux-XXXX.sdk.tar.bz2
        $ tar xvf xulrunner-*.tar.bz2
        $ mkdir ~/opt
        $ mv xulrunner-sdk ~/opt/
 3. Clone the git repository of System Monitor (and checkout a released version
    you want to build if needed).
        $ git clone git@github.com:clear-code/system-monitor.git
        $ git tag -l
        $ git checkout refs/tags/X.X.X
 4. Build it.
        $ cd system-monitor-X.X.X
        $ ./autogen.sh
        $ ./configure --with-libxul-sdk=~/opt/xulrunner-sdk
        $ make

To rebuild .xpt files, do:

        $ make clean
        $ ./configure --with-libxul-sdk=/path/to/xulrunner-sdk
        $ make
        $ mv -f components/*.xpt components/gecko2/

If there is no need to rebuild binaries, you can make an XPI package with
pre-built binaries.

        $ ./autogen.sh
        $ ./configure --with-libxul-sdk=/path/to/xulrunner-sdk
        $ make xpi

## Windows

 1. Install required softwares.
    * Cygwin ( http://www.cygwin.com/ ) with following packages:
      * automake
      * gcc
      * gcc4
      * libtool
      * make
      * pkg-config
      * zip
    * Microsoft Visual C++ 2008 Express Edition
      http://www.microsoft.com/express/Downloads/#Visual_Studio_2008_Express_Downloads
 2. Clone the git repository of System Monitor (and checkout a released version
    you want to build if needed).
 3. Download and extract Gecko SDK:
      http://releases.mozilla.org/pub/mozilla.org/xulrunner/releases/X.X.X
        /sdk/xulrunner-X.X.X.en-US.win32.sdk.zip
    Then, a folder "xulrunner-sdk" will appear, so move it to "c:\xulrunner".
    (Note: Don't put as "c:\xulrunner\xulrunner-sdk"!)
 4. Start "Cygwin Bash Shell", and run start building process.
        $ cd ~/system-monitor-X.X.X
        $ ./autogen.sh
        $ ./configure --with-libxul-sdk=/cygdrive/c/xulrunner
        $ make
    This operation will failed with some errors, because binary components
    of this software couldn't built on Cygwin. You have to build them by
    VC++.
 5. Start VC++, by double click on the file:
    system-monitor-X.X.X\components\SystemMonitor\SystemMonitor.vcproj
    After VC++ started and the project was completely loaded, then,
    choose "Release" from the listbox in the toolbar and choose
    "Build" => "Build SystemMonitor" to start building process.
    You'll see a last line of build log:
        Build: 1 Success, 0 Fail, ....
 6. Create XPI files. Back to Cygwin Bash Shell and make it.
        $ make xpi

If you want to put Gecko SDK in your favorite place, you have to update
"SystemMonitor.vcproj". Replace all "c:\xulrunner" embedded pathes in the
file to your favorite place.

If there is no need to rebuild binaries, you can make an XPI package from
default pre-built binaries.

        $ ./automake.sh
        $ ./configure --with-libxul-sdk=/cygdrive/c/xulrunner
        $ make xpi

## Mac OS X (32bit, Intel processor)

 1. Install required softwares.
    * Xcode 3 ( http://developer.apple.com/technologies/tools/xcode.html )
    * MacPorts ( http://www.macports.org/ ) with following packages:
      * pkg-config (pkgconfig)
      * libidl
        $ sudo port selfupdate
        $ sudo port install pkgconfig +libidl
 2. Clone the git repository of System Monitor (and checkout a released version
    you want to build if needed).
 3. Download and extract Gecko SDK:
      http://releases.mozilla.org/pub/mozilla.org/xulrunner/releases/X.X.X
        /sdk/xulrunner-X.X.X.en-US.mac-i386.sdk.tar.bz2
    Then, a folder "xulrunner-sdk" will appear, so move it to "/opt/xulrunner-sdk".
 4. Build it.
        $ cd ~/system-monitor-X.X.X
        $ ./autogen.sh
        $ ./configure --with-libxul-sdk=/opt/xulrunner-sdk CXXFLAGS="-arch i386"
        $ make

If the "configure" fails with an error about PKG_CHECK_MODULES, then, you
have to clean up old files and rebuild all files like:
        $ ./autogen.sh && make distclean && ./autogen.sh && ./configure
             --with-libxul-sdk=/opt/xulrunner-sdk/ CXXFLAGS="-arch i386" && make 

If you want to build binaries for both Firefox 3.5 and 3.6, then specify
each version of Gecko SDK by the configure option "--with-libxul-sdk".

If there is no need to rebuild binaries, you can make an XPI package from
default pre-built binaries.

        $ ./automake.sh
        $ ./configure --with-libxul-sdk=/opt/xulrunner-sdk CXXFLAGS="-arch i386"
        $ make xpi

# How to change the version number?

The version number is defined in a configuration file "configure.ac".
After you modify it, you need to do re-configure like:

        $ ./autogen.sh
        $ ./configure --with-libxul-sdk=/path/to/xulrunner-sdk
